# PHPStan Configuration for AI-SDLC Framework
# Credit repair domain-specific static analysis

parameters:
    level: 8
    paths:
        - app
        - config
        - database
        - routes

    # Exclude paths that don't need strict analysis
    excludePaths:
        - app/Console/Kernel.php
        - app/Http/Kernel.php
        - app/Providers/RouteServiceProvider.php
        - bootstrap/cache
        - storage
        - vendor

    # Credit repair domain-specific rules
    ignoreErrors:
        # Allow dynamic properties for credit score calculations
        - '#Access to an undefined property App\\Models\\CreditReport::\$[a-zA-Z0-9_]+#'

        # Allow complex credit calculation methods
        - '#Method App\\Services\\CreditCalculationService::[a-zA-Z0-9_]+\(\) has parameter \$[a-zA-Z0-9_]+ with no value type specified in iterable type array#'

        # Allow FCRA compliance validation methods
        - '#Method App\\Services\\FCRAComplianceService::[a-zA-Z0-9_]+\(\) should return [a-zA-Z0-9_\\\\]+ but returns [a-zA-Z0-9_\\\\]+#'

    # Enable strict rules for credit repair compliance
    checkMissingIterableValueType: true
    checkGenericClassInNonGenericObjectType: true
    checkMissingCallableSignature: true
    checkMissingVarDocTypeHint: true
    checkTooWideReturnTypesInProtectedAndPublicMethods: true
    checkUninitializedProperties: true
    checkDynamicProperties: false  # Allow for credit data flexibility

    # Custom rules for credit repair domain
    customRulesetUsed: true

    # Baseline for existing code
    baseline: phpstan-baseline.neon

    # Extensions for Laravel
    includes:
        - vendor/nunomaduro/larastan/extension.neon

    # Memory limit for complex credit calculations
    memoryLimitFile: .phpstan-memory-limit

    # Parallel processing
    parallel:
        jobSize: 20
        maximumNumberOfProcesses: 32
        minimumNumberOfJobsPerProcess: 2

    # Error format for CI/CD integration
    errorFormat: table

    # Cache directory
    tmpDir: storage/phpstan

    # Custom services for credit repair validation
    services:
        -
            class: App\PHPStan\FCRAComplianceRule
            tags:
                - phpstan.rules.rule
        -
            class: App\PHPStan\CreditScoreValidationRule
            tags:
                - phpstan.rules.rule
        -
            class: App\PHPStan\PIIDataProtectionRule
            tags:
                - phpstan.rules.rule
